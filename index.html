<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FunTarget Spinner - Bottom Adjusted</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <style>
        /* =========================================
           CORE RESET
           ========================================= */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }

        html, body { 
            width: 100vw; 
            height: 100vh; 
            overflow: hidden; 
            background: #000; 
            display: flex; 
            justify-content: center; 
            align-items: flex-end; /* गेम हमेशा नीचे रहेगा */
            touch-action: none;
        }

        /* Responsive Wrapper: Bottom-Center Origin */
        #game-wrapper {
            width: 1280px; 
            height: 720px; 
            position: absolute;
            bottom: 0; /* नीचे से सटा हुआ */
            transform-origin: bottom center; /* स्केल नीचे से ऊपर होगा */
            display: flex;
            flex-direction: column;
            background-image: url('https://uploads.onecompiler.io/445tyzay6/448mutbvh/1000053141.png');
            background-size: 100% 100%;
            overflow: hidden;
            z-index: 10;
        }

        .stars { position: absolute; inset: 0; z-index: 1; pointer-events: none; }
        .stars::after { 
            content: ""; position: absolute; width: 200%; height: 200%; 
            background: radial-gradient(2px 2px at 20% 30%, #fff, transparent), radial-gradient(2px 2px at 80% 60%, #fff, transparent); 
            animation: moveStars 12s linear infinite; 
        }
        @keyframes moveStars { from { transform: translateY(0); } to { transform: translateY(-200px); } }

        .content { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; flex-direction: column; padding: 10px; }

        /* Controls */
        #cancelSpecific { position: absolute; top: 45%; left: 30px; background: linear-gradient(180deg, #9c2b2b, #6a1a1a); color: white; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; z-index: 100; font-size: 18px; }
        #cancelAll { position: absolute; top: 45%; right: 30px; background: linear-gradient(180deg, #223b8b, #14255a); color: white; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; z-index: 100; font-size: 18px; }

        .top-section { display: flex; justify-content: space-between; align-items: flex-start; flex: 1; padding: 10px 40px; }
        
        .panel { background: rgba(0,0,0,0.7); border: 2px solid gold; border-radius: 10px; padding: 10px; min-width: 180px; text-align: center; }
        .panel h4 { font-size: 16px; margin-bottom: 5px; color: gold; letter-spacing: 1px; }
        .panel .value { background: linear-gradient(0deg, #fff3b1, #ffd36a); color: #000; font-size: 32px; font-weight: 900; border-radius: 5px; padding: 5px; }

        /* Wheel Area */
        .wheel-container { position: relative; width: 450px; height: 450px; display: flex; justify-content: center; align-items: center; margin-top: -20px; }
        canvas#wheel { width: 100%; height: 100%; filter: drop-shadow(0 0 15px rgba(255,215,0,0.5)); }

        .slider-box { 
            position: absolute; width: 110px; height: 110px; background: #000; border: 5px solid gold; 
            border-radius: 50%; overflow: hidden; z-index: 50; box-shadow: 0 0 30px gold;
        }
        .slides-inner { display: flex; width: 1000%; height: 100%; transition: transform 5s cubic-bezier(0.1, 0, 0.1, 1); }
        .slide-item { width: 10%; display: flex; justify-content: center; align-items: center; }
        .slide-item img { width: 80%; }

        .ptr { position: absolute; top: -15px; width: 160px; z-index: 60; filter: drop-shadow(0 5px 5px black); }

        /* Bottom Betting - FIXED AT BOTTOM */
        .bet-grid { display: flex; justify-content: center; gap: 12px; padding: 20px 0; background: rgba(0,0,0,0.5); }
        .num-box { width: 100px; height: 100px; background: linear-gradient(145deg, #FFD700, #b8860b); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; border: 3px solid #111; box-shadow: 0 5px 0 #666; }
        .num-box .digit { font-size: 45px; font-weight: 900; color: #111; }
        .num-box .bet-val { position: absolute; top: -12px; background: #ff0000; padding: 3px 10px; border-radius: 12px; font-size: 14px; color: white; display: none; border: 2px solid white; font-weight: bold; z-index: 20; }

        .chip-stack { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .chip { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 4px dashed white; cursor: pointer; transition: 0.2s; font-size: 18px; color: white; }
        .chip.active { transform: scale(1.25); border-style: solid; box-shadow: 0 0 20px white; z-index: 5; }

        /* Status & UI Elements */
        #gameStatus { text-align: center; color: #ffd36a; font-size: 24px; font-weight: bold; padding: 10px; background: rgba(0,0,0,0.8); border-top: 2px solid gold; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .card { background: #111; padding: 40px; border-radius: 20px; border: 3px solid gold; width: 350px; text-align: center; color: white; }
        .card input { width: 100%; padding: 15px; margin: 15px 0; border-radius: 8px; border: none; font-size: 16px; }
        .card button { width: 100%; padding: 15px; background: gold; border: none; font-weight: bold; cursor: pointer; font-size: 18px; border-radius: 8px; }

    </style>
</head>
<body>

    <div id="game-wrapper">
        <div class="stars"></div>
        <div class="content">
            <div style="position: absolute; top: 15px; right: 20px; display: flex; gap: 15px;">
                <button onclick="openSendPopup()" style="background:#00c853; color:white; border:none; padding:8px 20px; border-radius:5px; font-weight:bold; cursor:pointer;">SEND</button>
                <button onclick="logoutUser()" style="background:#1e90ff; color:white; border:none; padding:8px 20px; border-radius:5px; font-weight:bold; cursor:pointer;">LOGOUT</button>
            </div>

            <button id="cancelSpecific" onclick="cancelLastBet()">UNDO</button>
            <button id="cancelAll" onclick="cancelAllBets()">CLEAR</button>

            <div class="top-section">
                <div>
                    <div class="panel"><h4>COINS</h4><div id="coins" class="value">0</div></div>
                    <div class="chip-stack">
                        <div class="chip" style="background:linear-gradient(#9c27b0, #673ab7)" onclick="selectChip(1, this)">1</div>
                        <div class="chip" style="background:linear-gradient(#ff9800, #f44336)" onclick="selectChip(5, this)">5</div>
                        <div class="chip active" style="background:linear-gradient(#009688, #00796b)" onclick="selectChip(10, this)">10</div>
                    </div>
                </div>

                <div class="wheel-container">
                    <img src="https://uploads.onecompiler.io/445tyzay6/447a3r3jd/1000038035.png" class="ptr">
                    <div class="slider-box">
                        <div class="slides-inner" id="slider"></div>
                    </div>
                    <canvas id="wheel" width="500" height="500"></canvas>
                </div>

                <div>
                    <div class="panel"><h4>WINNER</h4><div id="winner" class="value">-</div></div>
                    <div class="panel" style="margin-top:10px;"><h4>TIME</h4><div id="time" class="value">60</div></div>
                    <div class="chip-stack">
                        <div class="chip" style="background:linear-gradient(#2196f3, #0d47a1)" onclick="selectChip(100, this)">100</div>
                        <div class="chip" style="background:linear-gradient(#f44336, #b71c1c)" onclick="selectChip(500, this)">500</div>
                        <div class="chip" style="background:linear-gradient(#ffd600, #ff8f00); color:black" onclick="selectChip(1000, this)">1k</div>
                    </div>
                </div>
            </div>

            <div id="last10" style="text-align:center; padding:5px; color:gold; font-weight:bold; font-size:18px;">HISTORY: ...</div>

            <div class="bet-grid" id="betGrid"></div>
            
            <div id="gameStatus">PLEASE LOGIN FIRST</div>
        </div>
    </div>

    <div id="loginBlock" class="overlay">
        <div class="card">
            <h2 style="color:gold; margin-bottom:10px;">GAME LOGIN</h2>
            <input id="uid" placeholder="User ID">
            <input id="pass" type="password" placeholder="Password">
            <button onclick="login()">LOGIN NOW</button>
            <p id="loginStatus" style="color:#ff5252; margin-top:10px;"></p>
        </div>
    </div>

    <div id="sendPopup" class="overlay" style="display:none">
        <div class="card">
            <h2 style="margin-bottom:10px;">SEND COINS</h2>
            <input id="sendUID" placeholder="Receiver UID">
            <input id="sendAmount" type="number" placeholder="Amount">
            <button onclick="sendCoins()" style="background:#00c853; color:white;">CONFIRM SEND</button>
            <button onclick="closeSendPopup()" style="background:#444; color:white; margin-top:10px;">CANCEL</button>
        </div>
    </div>

    <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>

    <script>
        /* =========================================
           BOTTOM-UP SCALING LOGIC
           ========================================= */
        function adjustScale() {
            const wrapper = document.getElementById('game-wrapper');
            const winW = window.innerWidth;
            const winH = window.innerHeight;
            
            // स्केल को विड्थ और हाइट के हिसाब से कैलकुलेट करें
            const scale = Math.min(winW / 1280, winH / 720);
            wrapper.style.transform = `scale(${scale})`;
            
            // गेम हमेशा नीचे सटा रहे
            wrapper.style.bottom = "0px";
        }
        window.addEventListener('resize', adjustScale);
        window.addEventListener('load', adjustScale);

        /* =========================================
           GAME LOGIC (Firebase & Mechanics)
           ========================================= */
        const firebaseConfig = {
            apiKey: "AIzaSyA-KabHNxU7PmQ3sARjqY7XrZ7LI5rSI8E",
            authDomain: "funtop-453ec.firebaseapp.com",
            databaseURL: "https://funtop-453ec-default-rtdb.firebaseio.com",
            projectId: "funtop-453ec",
            appId: "1:711635468186:web:3a8170c59cf9daa8c34423"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(), rtdb = firebase.database();
        const timerDoc = db.collection("settings").doc("timer");

        const state = {
            uid: null, coins: 0, timer: 60, bets: Array(10).fill(0), 
            selectedAmt: 10, spinning: false, history: []
        };

        // Initialize UI
        const slider = document.getElementById('slider');
        for(let i=0; i<10; i++) {
            slider.innerHTML += `<div class="slide-item"><img src="https://uploads.onecompiler.io/445tyzay6/448mfppru/1000053482.png"></div>`;
            document.getElementById('betGrid').innerHTML += `
                <div class="num-box" onclick="placeBet(${i})">
                    <div class="bet-val" id="bet-${i}">0</div>
                    <div class="digit">${i}</div>
                </div>
            `;
        }

        // Realtime Sync
        timerDoc.onSnapshot(snap => {
            const data = snap.data();
            if(!data) return;
            
            if(data.timerStartTime) {
                const now = Date.now();
                const diff = Math.floor((now - data.timerStartTime.toMillis())/1000);
                let left = 60 - diff;
                state.timer = left < 0 ? 0 : left;
                document.getElementById('time').innerText = state.timer;

                if(left > 10) { 
                    if(state.spinning) resetGameUI(); 
                    document.getElementById('gameStatus').innerText = "PLACE YOUR BETS";
                    document.getElementById('gameStatus').style.color = "#ffd36a";
                } else {
                    document.getElementById('gameStatus').innerText = "STOP BETTING";
                    document.getElementById('gameStatus').style.color = "#ff5252";
                }
            }

            if(data.status === "RESULT" && !state.spinning) startSpin(data.result);
        });

        function placeBet(num) {
            if(state.timer <= 10 || !state.uid || state.coins < state.selectedAmt) return;
            state.coins -= state.selectedAmt;
            state.bets[num] += state.selectedAmt;
            updateUI();
            playClick();
            
            const up = {}; up[`bets.${num}`] = firebase.firestore.FieldValue.increment(state.selectedAmt);
            timerDoc.update(up);
            rtdb.ref("users/uid/"+state.uid).update({coins: state.coins});
        }

        function startSpin(res) {
            state.spinning = true;
            slider.style.transition = "transform 5s cubic-bezier(0.1, 0, 0.1, 1)";
            slider.style.transform = `translateX(-${res * 10}%)`;
            
            const wheel = document.getElementById('wheel');
            wheel.style.transition = "transform 5s cubic-bezier(0.1, 0, 0.1, 1)";
            wheel.style.transform = `rotate(${3600 - (res * 36)}deg)`;

            setTimeout(() => {
                document.getElementById('winner').innerText = res;
                state.history.unshift(res);
                document.getElementById('last10').innerText = "HISTORY: " + state.history.slice(0,10).join(", ");
                checkWin(res);
            }, 5000);
        }

        function checkWin(res) {
            if(state.bets[res] > 0) {
                const win = state.bets[res] * 9;
                state.coins += win;
                updateUI();
                rtdb.ref("users/uid/"+state.uid).update({coins: state.coins});
                document.getElementById('gameStatus').innerText = "YOU WON " + win + "!";
            }
        }

        function resetGameUI() {
            state.spinning = false;
            state.bets.fill(0);
            document.getElementById('winner').innerText = "-";
            slider.style.transition = "none";
            slider.style.transform = "translateX(0)";
            document.getElementById('wheel').style.transition = "none";
            document.getElementById('wheel').style.transform = "rotate(0deg)";
            updateUI();
        }

        function updateUI() {
            document.getElementById('coins').innerText = state.coins;
            state.bets.forEach((amt, i) => {
                const el = document.getElementById(`bet-${i}`);
                el.innerText = amt;
                el.style.display = amt > 0 ? "block" : "none";
            });
        }

        function selectChip(amt, el) {
            state.selectedAmt = amt;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
        }

        const ctx = document.getElementById('wheel').getContext('2d');
        function drawWheel() {
            for(let i=0; i<10; i++) {
                ctx.beginPath(); ctx.moveTo(250,250);
                ctx.arc(250,250, 240, (i*36)*Math.PI/180, ((i+1)*36)*Math.PI/180);
                ctx.fillStyle = i % 2 === 0 ? "#FFD700" : "#FFF3B1";
                ctx.fill(); ctx.lineWidth = 2; ctx.stroke();
                ctx.fillStyle = "#000"; ctx.font = "bold 30px Arial";
                ctx.fillText(i, 250 + 180 * Math.cos((i*36+18)*Math.PI/180), 250 + 180 * Math.sin((i*36+18)*Math.PI/180));
            }
        }
        drawWheel();

        async function login() {
            const id = document.getElementById('uid').value.trim();
            const p = document.getElementById('pass').value.trim();
            const snap = await rtdb.ref("users/uid/"+id).once("value");
            if(snap.exists() && snap.val().password == p) {
                state.uid = id; state.coins = snap.val().coins;
                document.getElementById('loginBlock').style.display = "none";
                updateUI();
            } else { document.getElementById('loginStatus').innerText = "Invalid ID or Password"; }
        }

        function logoutUser() { location.reload(); }
        function openSendPopup() { document.getElementById('sendPopup').style.display="flex"; }
        function closeSendPopup() { document.getElementById('sendPopup').style.display="none"; }
        function playClick() { document.getElementById('clickSound').play().catch(()=>{}); }
    </script>
</body>
</html>
