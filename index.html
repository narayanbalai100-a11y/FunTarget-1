<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FunTarget - Double Golden Ring ner</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
     <script src="image_b64"></script>
    <style>
        /* =========================================
           CSS STYLES (NO CHANGES AT ALL)
           ========================================= */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Arial, sans-serif; }
        html, body { height: 100%; width: 100%; overflow: hidden; position: fixed; touch-action: manipulation; background: black; color: #fff; transform-origin: 0 0; }
        .portrait-warning { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 99999999; color: #FFD700; text-align: center; padding: 20% 10%; }
        .rotate-icon { font-size: 60px; margin: 20px 0; display: block; animation: rotateAnimation 2s infinite; }
        @keyframes rotateAnimation { 0% { transform: rotate(0deg); } 100% { transform: rotate(90deg); } }
        .device-warning { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 999999999; color: #FFD700; text-align: center; padding: 20% 10%; }
        .stars { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: -1000; overflow: hidden; }
        .stars::after { content: ""; position: absolute; width: 200%; height: 200%; background: radial-gradient(2px 2px at 20% 30%, #fff, transparent), radial-gradient(2px 2px at 80% 60%, #fff, transparent); animation: moveStars 12s linear infinite; }
        @keyframes moveStars { from { transform: translateY(0); } to { transform: translateY(-200px); } }
        .game-container-wrap { position: fixed; inset: 0; width: 100vw; height: 70vh; background-image: url('https://uploads.onecompiler.io/445tyzay6/449y5qe6e/1000061382.jpg'); background-size: cover; background-position: center; z-index: 100; border: 1px solid #333; overflow: hidden; }
        .game-app { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; background: rgba(0, 0, 0, 0.2); }
        #cancelSpecific { background: linear-gradient(180deg, #9c2b2b, #6a1a1a); position: absolute; top: 200px; left: 10px; width: 70px; height: 30px; z-index: 1000; font-size: 12px; color: white; border-radius: 4px; }
        #cancelAll { background: linear-gradient(180deg, #223b8b, #14255a); position: absolute; top: 200px; right: 10px; width: 60px; height: 30px; z-index: 1000; font-size: 12px; color: white; border-radius: 4px; }
        .top-row { display: flex; justify-content: space-between; align-items: flex-start; padding: 5px 10px; height: 180px; }
        .wheel-base-image { position: fixed; width: 920px; height: 125px; border-radius: 50%; background-image: url('https://uploads.onecompiler.io/445tyzay6/449sn6br3/1000061003.png'); background-size: 100% 100%; top: 1%; left: 50%; transform: translate(-50%, 150%); z-index: 1000; pointer-events: none; }
        .small-item { position: absolute; width: 50px; height: 50px; background-image: url('https://uploads.onecompiler.io/445tyzay6/449z2eg9r/1000061219.png'); background-size: contain; animation: blink-animation 0.7s infinite alternate; }
        @keyframes blink-animation { from { opacity: 1; transform: scale(0.4); } to { opacity: 0.8; transform: scale(1); } }
        .item-1 { left: 4%; top: 40%; } .item-2 { left: 12%; top: 45%; } .item-3 { left: 19%; top: 50%; } .item-4 { left: 26%; top: 55%; }
        .panel { background: rgba(0,0,0,0); min-width: 140px; margin-bottom: 5px; }
        .panel h4 { font-size: 14px; text-align: center; color: #ffd700; }
        .panel .value { background: linear-gradient(0deg, #fff3b1, #ffd36a); color: #000; padding: 2px 10px; border-radius: 30px; text-align: center; font-weight: 700; font-size: 22px; }
        .chip-container { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .chip { width: 40px; height: 40px; border-radius: 50%; border: 3px dashed rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; font-weight: bold; background: radial-gradient(circle, #444, #000); font-size: 12px; }
        .chip.active { border: 3px solid #ffd36a; box-shadow: 0 0 10px #ffd36a; }
        .wheel-wrap { width: 330px; height: 330px; display: flex; align-items: center; justify-content: center; position: relative; margin: 0 auto; }
        canvas#wheel { width: 500px; height: 290px; border-radius: 50%; }
        .ball-frame { position: absolute; width: 105px; height: 100px; border-radius: 50%; top: 50%; left: 50.1%; transform: translate(-50%, -50%); z-index: 100; background-color: #ffffff; pointer-events: none; }
        .ning-ball { width: 100%; height: 101%; background-size: 100%; background-repeat: no-repeat; }
        .animate-now { animation: rotateBall 1s steps(2) 8 forwards; }
        @keyframes rotateBall { 0% { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg'); } 100% { background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg'); } }
        .bottom-controls-wrap { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000; }
        .bet-row { display: flex; justify-content: space-between; width: 100%; padding: 0 10px; margin-top: 100px; position: relative; }
        .number-box { flex: 1; text-align: center; position: relative; }
        .number-box .num { width: 45px; height: 45px; border-radius: 50px; display: inline-flex; align-items: center; justify-content: center; font-weight: 800; color: #1b1300; background: linear-gradient(145deg, #FFD700, #b8860b); }
        .number-box .bet-placed { position: absolute; left: 50%; transform: translateX(-50%); bottom: 50px; padding: 2px 10px; border-radius: 15px; color: #111; font-weight: 700; font-size: 12px; background: #FFD700; display: none; }
        .status-bar { background: linear-gradient(145deg, #000, #333); color: #eee; font-weight: 800; text-align: center; padding: 5px; }
        #topActions { position: absolute; top: 2px; right: 25px; display: flex; gap: 5px; z-index: 99999; }
        #topActions button { padding: 6px 12px; font-size: 11px; color: #fff; border: none; border-radius: 4px; }
    </style>
</head>

<body>

<div id="deviceWarning" class="device-warning">
    <h2>MOBILE DEVICE REQUIRED</h2>
</div>

<div class="portrait-warning">
    <h2>Please Rotate Your Device</h2>
</div>

<div class="stars"></div>
<div class="game-container-wrap" id="mainGame">
    <div class="game-app">
        <div id="topActions">
            <button style="background: green;" onclick="openSendPopup()">SEND</button>
            <button style="background: blue;" onclick="logoutUser()">LOGOUT</button>
        </div>
        
        <button id="cancelSpecific" onclick="cancelLastBet()">CANCEL</button>
        <button id="cancelAll" onclick="cancelAllBets()">CLEAR</button>

        <div class="top-row">
            <div class="left-panels">
                <div class="panel"><h4>Coins</h4><div id="coins" class="value">0</div></div>
                <div class="panel"><h4>Time</h4><div id="time" class="value">--</div></div>
                <div class="chip-container" id="chipBoxLeft"></div>
            </div>

            <div class="center-wheel-container">
                <div class="wheel-wrap">
                    <div class="slider-container"><div class="slides-inner" id="slider"></div></div>
                    <div class="ball-frame"><div id="ball" class="ning-ball" style="background-image: url('https://uploads.onecompiler.io/445tyzay6/449rx2mty/1000060967.jpg');"></div></div>
                    <canvas id="wheel" width="600" height="600"></canvas>
                </div>
            </div>

            <div class="right-panels">
                <div class="panel"><h4>Winner</h4><div id="winner" class="value">-</div></div>
                <div class="panel"><h4>History</h4><div id="last5">--</div></div>
                <div class="chip-container" id="chipBoxRight"></div>
            </div>
        </div>

        <div class="bottom-controls-wrap">
            <div class="bet-row" id="betRow"></div>
            <div class="status-bar" id="gameStatus">PLACE YOUR BETS</div>
        </div>
    </div>
</div>

<div id="sendPopup" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:999999;align-items:center;justify-content:center">
    <div style="background:#111;padding:20px;border-radius:12px;width:280px;text-align:center">
        <h3>Send Coins</h3>
        <input id="sendUID" placeholder="Receiver UID" style="width:100%;padding:10px;margin:6px 0;">
        <input id="sendAmount" type="number" placeholder="Amount" style="width:100%;padding:10px;margin:6px 0;">
        <button onclick="sendCoins()" style="width:100%;padding:10px;background:#00c853;border:none;">SEND</button>
        <button onclick="closeSendPopup()" style="width:100%;margin-top:6px;padding:8px;background:#444;">CANCEL</button>
    </div>
</div>

<script>
    // --- FIREBASE CONFIG (AS PER YOUR ORIGINAL) ---
    const firebaseConfig = {
        apiKey: "AIzaSyA-KabHNxU7PmQ3sARjqY7XrZ7LI5rSI8E",
        authDomain: "funtop-453ec.firebaseapp.com",
        databaseURL: "https://funtop-453ec-default-rtdb.firebaseio.com",
        projectId: "funtop-453ec",
        appId: "1:711635468186:web:3a8170c59cf9daa8c34423"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const rtdb = firebase.database();
    const auth = firebase.auth();

    // --- GAME STATE (YOUR ORIGINAL 1001 SYSTEM) ---
    const state = {
        uid: "1001", // Default UID
        coins: 0, timer: 60, betting: true, ning: false,
        bets: Array(10).fill(0), betHistory: [], selectedAmount: 10,
        currentHistory: [], chips: [1, 5, 10, 100, 500, 1000]
    };

    // --- UID SYSTEM SYNC (ID के अंदर का सारा सिस्टम यहाँ लोड होगा) ---
    function syncIDSystem(uid) {
        // 1. कोइन्स सिंक (ID आधारित)
        rtdb.ref("users/uid/" + uid + "/coins").on("value", (snapshot) => {
            state.coins = Number(snapshot.val()) || 0;
            document.getElementById('coins').textContent = state.coins;
        });

        // 2. आईडी के अंदर का पूरा डेटा (Firestore)
        db.collection("users").doc(uid).onSnapshot((doc) => {
            if(doc.exists) {
                const fullData = doc.data();
                console.log("Full ID System Loaded:", fullData);
                // यहाँ आप ID के अंदर के दूसरे सिस्टम को इस्तेमाल कर सकते हैं
            }
        });
    }

    // --- INITIALIZE GAME ---
    window.onload = () => {
        syncIDSystem(state.uid); // आईडी सिंक चालू करें
        initGameListeners();
        renderBetButtons();
        updateChipsUI();
        drawWheel(0);
    };

    function initGameListeners() {
        // History Listener
        rtdb.ref('history').limitToLast(5).on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) { state.currentHistory = Object.values(data).reverse(); refreshHistoryUI(); }
        });

        // Timer Listener
        db.collection("settings").doc("timer").onSnapshot((snap) => {
            const data = snap.data();
            if(!data) return;
            if (data.status === "RESULT" && !state.ning) { START_SPIN_ANIMATION(data.result); }
            if (data.timerStartTime) { handleTimer(data.timerStartTime.toMillis()); }
        });
    }

    function handleTimer(startTime) {
        setInterval(() => {
            let left = 60 - Math.floor((Date.now() - startTime) / 1000);
            state.timer = left > 0 ? left : 0;
            document.getElementById("time").innerText = state.timer;
            state.betting = state.timer > 15;
            if(state.timer <= 15) document.getElementById("time").classList.add("timer-warning");
            else document.getElementById("time").classList.remove("timer-warning");
        }, 1000);
    }

    // --- BETTING & UI (YOUR ORIGINAL FUNCTIONS) ---
    function renderBetButtons() {
        const row = document.getElementById('betRow');
        for (let i = 0; i < 10; i++) {
            const box = document.createElement('div');
            box.className = 'number-box';
            box.innerHTML = `<div class="num">${i}</div><div class="bet-placed" id="bet-${i}">0</div>`;
            box.onclick = () => PLACE_BET(i);
            row.appendChild(box);
        }
    }

    async function PLACE_BET(n) {
        if (!state.betting || state.coins < state.selectedAmount) return;
        const amt = state.selectedAmount;
        rtdb.ref("users/uid/" + state.uid + "/coins").transaction(c => c - amt);
        state.bets[n] += amt;
        state.betHistory.push({n, amt});
        document.getElementById(`bet-${n}`).style.display = 'flex';
        document.getElementById(`bet-${n}`).textContent = state.bets[n];
        db.collection("settings").doc("timer").update({ [`bets.${n}`]: firebase.firestore.FieldValue.increment(amt) });
    }

    // --- WHEEL DRAW (YOUR ORIGINAL) ---
    const canvas = document.getElementById('wheel'), ctx = canvas.getContext('2d');
    function drawWheel(rot) {
        ctx.clearRect(0,0,600,600); ctx.save(); ctx.translate(300,300); ctx.rotate(rot);
        for(let i=0; i<10; i++){
            ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,290,i*Math.PI*2/10,(i+1)*Math.PI*2/10);
            ctx.fillStyle = i%2==0 ? '#ffd36a' : '#fff3b0'; ctx.fill();
        }
        ctx.restore();
    }

    function START_SPIN_ANIMATION(res) {
        state.ning = true;
        document.getElementById('ball').classList.add('animate-now');
        // Simple animation placeholder
        setTimeout(() => { 
            state.ning = false; 
            document.getElementById('winner').textContent = res;
            document.getElementById('ball').classList.remove('animate-now');
        }, 5000);
    }

    function updateChipsUI() {
        const l = document.getElementById('chipBoxLeft'), r = document.getElementById('chipBoxRight');
        l.innerHTML = ''; r.innerHTML = '';
        state.chips.forEach((amt, i) => {
            const c = document.createElement('div');
            c.className = 'chip' + (state.selectedAmount === amt ? ' active' : '');
            c.innerText = amt; c.onclick = () => { state.selectedAmount = amt; updateChipsUI(); };
            if(i<3) l.appendChild(c); else r.appendChild(c);
        });
    }

    function refreshHistoryUI() {
        const h = document.getElementById('last5'); h.innerHTML = '';
        state.currentHistory.forEach(num => { h.innerHTML += `<span class="hist-item">${num}</span>`; });
    }

    function openSendPopup() { document.getElementById("sendPopup").style.display="flex"; }
    function closeSendPopup() { document.getElementById("sendPopup").style.display="none"; }
    function logoutUser() { location.reload(); }
</script>
</body>
</html>
